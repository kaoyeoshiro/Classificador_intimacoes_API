<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classificador de Intima√ß√µes - TJMS</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const API_URL = "http://localhost:8000";

        function App() {
            console.log("App rendering v1.2 - Fixed deletion and timestamp");
            const [processes, setProcesses] = React.useState([]);
            const [prompts, setPrompts] = React.useState([]);
            const [view, setView] = React.useState('processes');
            const [selectedProcess, setSelectedProcess] = React.useState(null);
            const [editingPrompt, setEditingPrompt] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [bulkProgress, setBulkProgress] = React.useState({ current: 0, total: 0, errors: [] });
            const [isProcessingBulk, setIsProcessingBulk] = React.useState(false);
            const [inputProcessText, setInputProcessText] = React.useState("");
            const [classifyingProcess, setClassifyingProcess] = React.useState(null);
            const [collapsedGroups, setCollapsedGroups] = React.useState({});
            const [chatProcess, setChatProcess] = React.useState(null);
            const [chatHistory, setChatHistory] = React.useState({});
            const [chatMessage, setChatMessage] = React.useState("");
            const [chatLoading, setChatLoading] = React.useState(false);
            const [batchClassifyModal, setBatchClassifyModal] = React.useState(false);
            const [batchClassifyProgress, setBatchClassifyProgress] = React.useState([]);
            const [batchStats, setBatchStats] = React.useState(null);
            const [batchSettings, setBatchSettings] = React.useState({ force: false, maxConcurrent: 5, classe: '' });

            React.useEffect(() => {
                fetchProcesses();
                fetchPrompts();
                fetchBatchStats();
            }, []);

            const fetchProcesses = async () => {
                try {
                    const res = await axios.get(`${API_URL}/processes/`);
                    setProcesses(res.data);
                } catch (err) {
                    console.error("Erro ao buscar processos:", err);
                }
            };

            const fetchPrompts = async () => {
                try {
                    const res = await axios.get(`${API_URL}/prompts/`);
                    setPrompts(res.data);
                } catch (err) {
                    console.error("Erro ao buscar prompts:", err);
                }
            };

            const handleAddProcess = async (e) => {
                e.preventDefault();
                if (!inputProcessText.trim()) return;

                const lines = inputProcessText.split(/[\n,]/).map(s => s.trim());
                // Sanitize: remove dots, dashes, and limit to 20 chars
                const validNumbers = lines
                    .map(s => s.replace(/[.-]/g, '').slice(0, 20))
                    .filter(s => s.length > 0);

                const uniqueNumbers = [...new Set(validNumbers)];

                if (uniqueNumbers.length === 0) return;

                setLoading(true);
                setIsProcessingBulk(true);
                setBulkProgress({ current: 0, total: uniqueNumbers.length, errors: [] });

                let completed = 0;
                const errors = [];

                for (const num of uniqueNumbers) {
                    try {
                        await axios.post(`${API_URL}/processes/${num}`);
                    } catch (err) {
                        console.error(`Erro ao adicionar ${num}:`, err);
                        errors.push({ number: num, error: err.message });
                    }
                    completed++;
                    setBulkProgress(prev => ({ ...prev, current: completed, errors }));
                }

                setIsProcessingBulk(false);
                setLoading(false);
                setInputProcessText("");
                fetchProcesses();

                if (errors.length > 0) {
                    alert(`Processamento conclu√≠do com ${errors.length} erros.\nVerifique o console para detalhes.`);
                }
            };

            const handleClassify = async (numero) => {
                console.log("Iniciando classifica√ß√£o para:", numero);
                setClassifyingProcess(numero);
                try {
                    await axios.post(`${API_URL}/classify/${numero}`);
                    fetchProcesses();
                    if (selectedProcess && selectedProcess.numero === numero) {
                        // Refresh selected process details if open
                        const updated = await axios.get(`${API_URL}/processes/`);
                        const p = updated.data.find(p => p.numero === numero);
                        if (p) setSelectedProcess(p);
                    }
                } catch (err) {
                    console.error("Erro na classifica√ß√£o:", err);
                    alert("Erro ao classificar: " + (err.response?.data?.detail || err.message));
                } finally {
                    setClassifyingProcess(null);
                }
            };

            const handleDeleteProcess = async (numero) => {
                console.log("Tentando deletar processo:", numero, "Tipo:", typeof numero);

                // Ensure numero is a string and not empty
                if (!numero || String(numero).trim() === '') {
                    alert("N√∫mero do processo inv√°lido!");
                    return;
                }

                const numeroStr = String(numero).trim();

                if (!confirm(`Tem certeza que deseja excluir o processo ${numeroStr}?`)) return;
                try {
                    const url = `${API_URL}/processes/${encodeURIComponent(numeroStr)}`;
                    console.log("DELETE URL:", url);
                    await axios.delete(url);
                    fetchProcesses();
                    if (selectedProcess && selectedProcess.numero === numeroStr) {
                        setSelectedProcess(null);
                    }
                    alert("Processo exclu√≠do com sucesso!");
                } catch (err) {
                    console.error("Erro ao deletar processo:", err);
                    alert("Erro ao deletar: " + (err.response?.data?.detail || err.message));
                }
            };

            const handleUploadXML = async (e) => {
                e.preventDefault();
                const files = e.target.files;
                if (!files || files.length === 0) return;

                const formData = new FormData();
                for (let i = 0; i < files.length; i++) {
                    formData.append('files', files[i]);
                }

                setLoading(true);
                try {
                    const res = await axios.post(`${API_URL}/processes/upload`, formData, {
                        headers: {
                            'Content-Type': 'multipart/form-data'
                        }
                    });
                    fetchProcesses();
                    alert(`${res.data.length} arquivo(s) XML processado(s) com sucesso!`);
                    e.target.value = ''; // Clear file input
                } catch (err) {
                    console.error("Erro ao fazer upload de XML:", err);
                    alert("Erro ao fazer upload: " + (err.response?.data?.detail || err.message));
                } finally {
                    setLoading(false);
                }
            };

            const handleSendChatMessage = async (e) => {
                e.preventDefault();
                if (!chatMessage.trim() || !chatProcess) return;

                const processNumber = chatProcess.numero;
                const history = chatHistory[processNumber] || [];

                // Add user message to history
                const newUserMessage = { role: "user", content: chatMessage };
                const updatedHistory = [...history, newUserMessage];
                setChatHistory(prev => ({ ...prev, [processNumber]: updatedHistory }));
                setChatMessage("");
                setChatLoading(true);

                try {
                    const res = await axios.post(`${API_URL}/chat/${processNumber}`, {
                        message: chatMessage,
                        history: history
                    });

                    // Add assistant response to history
                    const assistantMessage = { role: "assistant", content: res.data.response };
                    setChatHistory(prev => ({
                        ...prev,
                        [processNumber]: [...prev[processNumber], assistantMessage]
                    }));
                } catch (err) {
                    console.error("Erro no chat:", err);
                    alert("Erro ao enviar mensagem: " + (err.response?.data?.detail || err.message));
                    // Remove user message on error
                    setChatHistory(prev => ({ ...prev, [processNumber]: history }));
                } finally {
                    setChatLoading(false);
                }
            };

            const openChat = (process) => {
                setChatProcess(process);
                if (!chatHistory[process.numero]) {
                    setChatHistory(prev => ({ ...prev, [process.numero]: [] }));
                }
            };

            const closeChat = () => {
                setChatProcess(null);
                setChatMessage("");
            };

            const fetchBatchStats = async () => {
                try {
                    const res = await axios.get(`${API_URL}/classify/statistics`);
                    setBatchStats(res.data);
                } catch (err) {
                    console.error("Erro ao buscar estat√≠sticas:", err);
                }
            };

            const startBatchClassify = async () => {
                setBatchClassifyProgress([]);
                setBatchClassifyModal(true);

                const params = new URLSearchParams({
                    force: batchSettings.force,
                    max_concurrent: batchSettings.maxConcurrent
                });
                if (batchSettings.classe) {
                    params.append('classe_processual', batchSettings.classe);
                }

                try {
                    const eventSource = new EventSource(`${API_URL}/classify/batch_progress?${params}`);

                    eventSource.onmessage = (event) => {
                        const data = JSON.parse(event.data);

                        setBatchClassifyProgress(prev => [...prev, data]);

                        if (data.type === 'complete') {
                            eventSource.close();
                            fetchProcesses();
                            fetchBatchStats();
                            setTimeout(() => {
                                alert(`Classifica√ß√£o conclu√≠da!\n‚úì ${data.sucesso} sucessos\n‚úó ${data.erros} erros`);
                            }, 500);
                        }
                    };

                    eventSource.onerror = (error) => {
                        console.error('Erro no SSE:', error);
                        eventSource.close();
                        alert('Erro ao conectar com o servidor para classifica√ß√£o em lote.');
                    };
                } catch (err) {
                    console.error("Erro ao iniciar classifica√ß√£o em lote:", err);
                    alert("Erro ao iniciar classifica√ß√£o: " + err.message);
                }
            };

            const handleExport = async (format) => {
                window.open(`${API_URL}/export/${format}`, '_blank');
            };

            const handleSavePrompt = async (e) => {
                e.preventDefault();
                const p = editingPrompt;
                const classesArray = typeof p.classes === 'string' ? p.classes.split(',').map(c => c.trim()).filter(c => c) : p.classes;
                const payload = { ...p, classes: classesArray };

                try {
                    if (prompts.find(existing => existing.id === p.id)) {
                        await axios.put(`${API_URL}/prompts/${p.id}`, payload);
                    } else {
                        await axios.post(`${API_URL}/prompts/`, payload);
                    }
                    setEditingPrompt(null);
                    fetchPrompts();
                } catch (err) {
                    alert("Erro ao salvar prompt: " + (err.response?.data?.detail || err.message));
                }
            };

            const handleDeletePrompt = async (id) => {
                if (!confirm("Tem certeza?")) return;
                try {
                    await axios.delete(`${API_URL}/prompts/${id}`);
                    fetchPrompts();
                } catch (err) {
                    alert("Erro ao deletar prompt: " + (err.response?.data?.detail || err.message));
                }
            };

            // Grouping Logic
            const getGroupedProcesses = () => {
                const groups = {};

                processes.forEach(proc => {
                    let dateKey = "N√£o Classificado";
                    let sortDate = 0;

                    if (proc.data_classificacao) {
                        const date = new Date(proc.data_classificacao);
                        const today = new Date();
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);

                        if (date.toDateString() === today.toDateString()) {
                            dateKey = "Hoje";
                            sortDate = today.getTime();
                        } else if (date.toDateString() === yesterday.toDateString()) {
                            dateKey = "Ontem";
                            sortDate = yesterday.getTime();
                        } else {
                            dateKey = date.toLocaleDateString();
                            sortDate = date.getTime();
                        }
                    }

                    if (!groups[dateKey]) {
                        groups[dateKey] = { label: dateKey, sortDate, items: [] };
                    }
                    groups[dateKey].items.push(proc);
                });

                // Sort groups: Today first, then Yesterday, then dates descending, then Unclassified
                const sortedGroups = Object.values(groups).sort((a, b) => {
                    if (a.label === "Hoje") return -1;
                    if (b.label === "Hoje") return 1;
                    if (a.label === "Ontem") return -1;
                    if (b.label === "Ontem") return 1;
                    if (a.label === "N√£o Classificado") return 1; // Put unclassified at bottom
                    if (b.label === "N√£o Classificado") return -1;
                    return b.sortDate - a.sortDate;
                });

                // Sort items within each group
                sortedGroups.forEach(group => {
                    group.items.sort((a, b) => {
                        if (a.data_classificacao && b.data_classificacao) {
                            return new Date(b.data_classificacao) - new Date(a.data_classificacao);
                        }
                        if (a.data_classificacao) return -1;
                        if (b.data_classificacao) return 1;
                        return 0;
                    });
                });

                return sortedGroups;
            };

            const toggleGroup = (label) => {
                console.log("Toggling group:", label);
                setCollapsedGroups(prev => ({
                    ...prev,
                    [label]: !prev[label]
                }));
            };

            const groupedProcesses = getGroupedProcesses();

            return (
                <div className="container mx-auto p-6 max-w-7xl">
                    <header className="mb-10 flex justify-between items-center">
                        <div>
                            <h1 className="text-3xl font-bold text-slate-800 tracking-tight">
                                Classificador Judicial
                                <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full ml-2 align-middle">v1.2</span>
                            </h1>
                            <p className="text-slate-500 mt-1">Gest√£o e Intelig√™ncia Artificial para Processos</p>
                        </div>
                        <div className="flex gap-3">
                            <button onClick={() => setView('processes')} className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${view === 'processes' ? 'bg-blue-600 text-white' : 'bg-white border border-slate-200 hover:bg-slate-50'}`}>
                                Processos
                            </button>
                            <button onClick={() => setView('prompts')} className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${view === 'prompts' ? 'bg-blue-600 text-white' : 'bg-white border border-slate-200 hover:bg-slate-50'}`}>
                                Prompts
                            </button>
                            <div className="w-px h-8 bg-slate-200 mx-2"></div>
                            <button onClick={() => handleExport('json')} className="px-4 py-2 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 text-sm font-medium transition-colors">
                                Exportar JSON
                            </button>
                            <button onClick={() => handleExport('excel')} className="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 text-sm font-medium transition-colors shadow-sm">
                                Exportar Excel
                            </button>
                        </div>
                    </header>

                    {view === 'processes' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Sidebar / Add Process */}
                            <div className="lg:col-span-1 space-y-6">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                    <h2 className="text-lg font-semibold mb-4">Adicionar Processos</h2>
                                    <form onSubmit={handleAddProcess} className="space-y-3">
                                        <textarea
                                            value={inputProcessText}
                                            onChange={(e) => setInputProcessText(e.target.value)}
                                            placeholder="Cole aqui os n√∫meros dos processos (um por linha ou separados por v√≠rgula)..."
                                            rows={5}
                                            className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-sm font-mono"
                                        />

                                        {isProcessingBulk && (
                                            <div className="space-y-2">
                                                <div className="flex justify-between text-xs text-slate-500">
                                                    <span>Processando...</span>
                                                    <span>{bulkProgress.current} / {bulkProgress.total}</span>
                                                </div>
                                                <div className="w-full bg-slate-100 rounded-full h-2 overflow-hidden">
                                                    <div
                                                        className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                                        style={{ width: `${(bulkProgress.current / bulkProgress.total) * 100}%` }}
                                                    ></div>
                                                </div>
                                                {bulkProgress.errors.length > 0 && (
                                                    <p className="text-xs text-red-500">{bulkProgress.errors.length} erros encontrados</p>
                                                )}
                                            </div>
                                        )}

                                        <button
                                            type="submit"
                                            disabled={loading}
                                            className="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors disabled:opacity-50"
                                        >
                                            {loading ? (isProcessingBulk ? "Processando Lote..." : "Adicionando...") : "Adicionar"}
                                        </button>
                                    </form>
                                    <p className="text-xs text-slate-400 mt-2">
                                        Dica: Voc√™ pode colar at√© 300 n√∫meros de uma vez. O sistema processar√° um por um. Pontos e tra√ßos s√£o removidos automaticamente.
                                    </p>
                                </div>

                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                    <h2 className="text-lg font-semibold mb-4">Upload de XMLs</h2>
                                    <div className="space-y-3">
                                        <div className="border-2 border-dashed border-slate-200 rounded-lg p-4 hover:border-blue-400 transition-colors">
                                            <label htmlFor="xml-upload" className="cursor-pointer flex flex-col items-center gap-2">
                                                <svg className="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                                </svg>
                                                <span className="text-sm font-medium text-slate-600">Clique para selecionar XMLs</span>
                                                <span className="text-xs text-slate-400">ou arraste arquivos aqui</span>
                                            </label>
                                            <input
                                                id="xml-upload"
                                                type="file"
                                                accept=".xml"
                                                multiple
                                                onChange={handleUploadXML}
                                                disabled={loading}
                                                className="hidden"
                                            />
                                        </div>
                                        <p className="text-xs text-slate-400">
                                            Voc√™ pode selecionar m√∫ltiplos arquivos XML. O sistema detectar√° duplicatas automaticamente e gerenciar√° as classifica√ß√µes.
                                        </p>
                                    </div>
                                </div>

                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                    <h2 className="text-lg font-semibold mb-4">Estat√≠sticas</h2>
                                    <div className="space-y-4">
                                        <div className="flex justify-between items-center">
                                            <span className="text-slate-500">Total Processos</span>
                                            <span className="font-bold text-xl">{processes.length}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-slate-500">Classificados</span>
                                            <span className="font-bold text-xl text-emerald-600">{processes.filter(p => p.classificacao).length}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-slate-500">Pendentes</span>
                                            <span className="font-bold text-xl text-orange-600">{processes.filter(p => !p.classificacao).length}</span>
                                        </div>
                                        {batchStats && (
                                            <div className="pt-2 border-t border-slate-100">
                                                <div className="text-xs text-slate-400 mb-2">Taxa de Conclus√£o</div>
                                                <div className="w-full bg-slate-100 rounded-full h-2 overflow-hidden">
                                                    <div
                                                        className="bg-emerald-500 h-2 rounded-full transition-all duration-300"
                                                        style={{ width: `${batchStats.completion_rate}%` }}
                                                    ></div>
                                                </div>
                                                <div className="text-xs text-slate-500 mt-1 text-right">{batchStats.completion_rate}%</div>
                                            </div>
                                        )}
                                        <button
                                            onClick={() => setBatchClassifyModal(true)}
                                            disabled={processes.filter(p => !p.classificacao).length === 0}
                                            className="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 font-medium transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                        >
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                            </svg>
                                            Classifica√ß√£o em Lote
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {/* Main List */}
                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                                    <div className="p-6 border-b border-slate-100">
                                        <h2 className="text-lg font-semibold">Hist√≥rico de Processos</h2>
                                    </div>

                                    {processes.length === 0 ? (
                                        <div className="p-8 text-center text-slate-400">
                                            Nenhum processo cadastrado.
                                        </div>
                                    ) : (
                                        <div className="divide-y divide-slate-100">
                                            {groupedProcesses.map(group => (
                                                <div key={group.label}>
                                                    <div
                                                        className="bg-slate-50 px-6 py-2 text-xs font-bold text-slate-500 uppercase tracking-wider border-y border-slate-100 flex justify-between items-center cursor-pointer hover:bg-slate-100 transition-colors"
                                                        onClick={() => toggleGroup(group.label)}
                                                    >
                                                        <span>{group.label}</span>
                                                        <svg
                                                            className={`w-4 h-4 transition-transform ${collapsedGroups[group.label] ? '-rotate-90' : ''}`}
                                                            fill="none"
                                                            stroke="currentColor"
                                                            viewBox="0 0 24 24"
                                                        >
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                                                        </svg>
                                                    </div>
                                                    {!collapsedGroups[group.label] && group.items.map(proc => (
                                                        <div key={proc.numero} className="p-6 hover:bg-slate-50 transition-colors group relative">
                                                            {String(classifyingProcess) === String(proc.numero) && (
                                                                <div className="absolute inset-0 bg-white/80 z-10 flex items-center justify-center backdrop-blur-sm">
                                                                    <div className="flex flex-col items-center gap-2">
                                                                        <div className="w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                                                                        <span className="text-sm font-medium text-blue-600">Classificando...</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            <div className="flex justify-between items-start mb-3">
                                                                <div>
                                                                    <h3 className="font-medium text-blue-600 text-lg flex items-center gap-2">
                                                                        {proc.numero}
                                                                        {proc.data_classificacao && (
                                                                            <span className="text-xs font-normal text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full">
                                                                                {new Date(proc.data_classificacao).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                                                                            </span>
                                                                        )}
                                                                    </h3>
                                                                    <p className="text-sm text-slate-500">{proc.classeProcessual} ‚Ä¢ {proc.competencia}</p>
                                                                </div>
                                                                <div className="flex gap-2">
                                                                    <button
                                                                        onClick={() => setSelectedProcess(proc)}
                                                                        className="px-3 py-1 text-xs font-medium bg-slate-100 text-slate-600 rounded-full hover:bg-slate-200 transition-colors"
                                                                    >
                                                                        Ver Detalhes
                                                                    </button>
                                                                    <button
                                                                        onClick={() => handleClassify(proc.numero)}
                                                                        disabled={String(classifyingProcess) === String(proc.numero)}
                                                                        className="px-3 py-1 text-xs font-medium bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 transition-colors disabled:opacity-50"
                                                                    >
                                                                        Classificar IA
                                                                    </button>
                                                                    {proc.classificacao && (
                                                                        <button
                                                                            onClick={() => openChat(proc)}
                                                                            className="px-3 py-1 text-xs font-medium bg-purple-50 text-purple-600 rounded-full hover:bg-purple-100 transition-colors"
                                                                        >
                                                                            üí¨ Conversar
                                                                        </button>
                                                                    )}
                                                                    <button
                                                                        onClick={() => handleDeleteProcess(proc.numero)}
                                                                        className="px-3 py-1 text-xs font-medium bg-red-50 text-red-600 rounded-full hover:bg-red-100 transition-colors"
                                                                    >
                                                                        Excluir
                                                                    </button>
                                                                </div>
                                                            </div>

                                                            {/* Classification Summary */}
                                                            {proc.classificacao && (
                                                                <div className="mb-3 p-3 bg-emerald-50 border border-emerald-100 rounded-lg">
                                                                    <div className="flex items-center gap-2 mb-1">
                                                                        <span className="text-xs font-bold text-emerald-700 uppercase">Classifica√ß√£o IA</span>
                                                                        <span className="text-xs text-emerald-600">{new Date(proc.data_classificacao).toLocaleString('pt-BR')}</span>
                                                                    </div>
                                                                    <div className="text-sm">
                                                                        <div><span className="font-semibold text-emerald-800">Tipo:</span> <span className="text-emerald-900">{proc.classificacao.tipo_intimacao || proc.classificacao.codigo || proc.classificacao.classificacao}</span></div>
                                                                    </div>
                                                                </div>
                                                            )}

                                                            {/* Movements Preview */}
                                                            <div className="mt-4 space-y-2">
                                                                <p className="text-xs font-semibold text-slate-400 uppercase tracking-wider">√öltima Movimenta√ß√£o</p>
                                                                {proc.movimentos && proc.movimentos.length > 0 ? (
                                                                    <div className="text-sm text-slate-700 bg-slate-50 p-3 rounded-lg border border-slate-100">
                                                                        <span className="font-medium block mb-1">{new Date(proc.movimentos[proc.movimentos.length - 1].dataHora).toLocaleDateString()}</span>
                                                                        {proc.movimentos[proc.movimentos.length - 1].descricao}
                                                                    </div>
                                                                ) : (
                                                                    <p className="text-sm text-slate-400 italic">Sem movimenta√ß√µes</p>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'prompts' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-1">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                    <h2 className="text-lg font-semibold mb-4">{editingPrompt ? 'Editar Prompt' : 'Novo Prompt'}</h2>
                                    <form onSubmit={handleSavePrompt} className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">ID (√∫nico)</label>
                                            <input
                                                type="text"
                                                value={editingPrompt?.id || ''}
                                                onChange={e => setEditingPrompt({ ...editingPrompt, id: e.target.value })}
                                                disabled={!!editingPrompt && prompts.some(p => p.id === editingPrompt.id)}
                                                className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none"
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Nome</label>
                                            <input
                                                type="text"
                                                value={editingPrompt?.name || ''}
                                                onChange={e => setEditingPrompt({ ...editingPrompt, name: e.target.value })}
                                                className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none"
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Classes (c√≥digos separados por v√≠rgula)</label>
                                            <input
                                                type="text"
                                                value={Array.isArray(editingPrompt?.classes) ? editingPrompt.classes.join(', ') : (editingPrompt?.classes || '')}
                                                onChange={e => setEditingPrompt({ ...editingPrompt, classes: e.target.value })}
                                                placeholder="Ex: 7, 1116, 1234"
                                                className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none"
                                            />
                                            <p className="text-xs text-slate-400 mt-1">Insira os c√≥digos das classes que usar√£o este prompt</p>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Conte√∫do do Prompt</label>
                                            <textarea
                                                value={editingPrompt?.content || ''}
                                                onChange={e => setEditingPrompt({ ...editingPrompt, content: e.target.value })}
                                                rows={10}
                                                className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none font-mono text-sm"
                                                required
                                            />
                                        </div>
                                        <div className="flex gap-2">
                                            <button type="submit" className="flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                                                Salvar
                                            </button>
                                            {editingPrompt && (
                                                <button type="button" onClick={() => setEditingPrompt(null)} className="px-4 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200">
                                                    Cancelar
                                                </button>
                                            )}
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                                    <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                                        <h2 className="text-lg font-semibold">Prompts Configurados</h2>
                                        <button
                                            onClick={() => setEditingPrompt({ id: '', name: '', classes: [], content: '' })}
                                            className="text-sm text-blue-600 hover:underline font-medium"
                                        >
                                            + Novo Prompt
                                        </button>
                                    </div>
                                    <div className="divide-y divide-slate-100">
                                        {prompts.map(prompt => (
                                            <div key={prompt.id} className="p-6 hover:bg-slate-50 transition-colors">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div>
                                                        <h3 className="font-medium text-slate-900">{prompt.name} <span className="text-xs text-slate-400 font-normal ml-2">ID: {prompt.id}</span></h3>
                                                        <p className="text-sm text-slate-500 mt-1">
                                                            Classes: {prompt.classes && prompt.classes.length > 0 ? prompt.classes.join(', ') : <span className="italic">Nenhuma (ser√° ignorado)</span>}
                                                        </p>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => setEditingPrompt(prompt)} className="text-blue-600 hover:text-blue-800 text-sm font-medium">Editar</button>
                                                        <button onClick={() => handleDeletePrompt(prompt.id)} className="text-red-600 hover:text-red-800 text-sm font-medium">Excluir</button>
                                                    </div>
                                                </div>
                                                <pre className="text-xs text-slate-600 bg-slate-50 p-3 rounded border border-slate-100 overflow-x-auto whitespace-pre-wrap max-h-32">
                                                    {prompt.content}
                                                </pre>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Process Details Modal */}
                    {
                        selectedProcess && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setSelectedProcess(null)}>
                                <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col" onClick={e => e.stopPropagation()}>
                                    <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                        <div>
                                            <h2 className="text-xl font-bold text-slate-800">Processo {selectedProcess.numero}</h2>
                                            <p className="text-sm text-slate-500">{selectedProcess.classeProcessual}</p>
                                        </div>
                                        <button onClick={() => setSelectedProcess(null)} className="text-slate-400 hover:text-slate-600">
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                                        </button>
                                    </div>

                                    <div className="p-6 overflow-y-auto space-y-8">
                                        {/* Classification Details */}
                                        {selectedProcess.classificacao ? (
                                            <div>
                                                <h3 className="text-lg font-semibold mb-3 text-emerald-700 flex items-center gap-2">
                                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                                    Resultado da Classifica√ß√£o
                                                </h3>
                                                <div className="bg-emerald-50 rounded-xl p-5 border border-emerald-100 space-y-4">
                                                    <div>
                                                        <span className="text-xs font-bold text-emerald-600 uppercase tracking-wider">Tipo de Intima√ß√£o</span>
                                                        <p className="mt-1 text-slate-800 font-medium">{selectedProcess.classificacao.tipo_intimacao || selectedProcess.classificacao.codigo || selectedProcess.classificacao.classificacao}</p>
                                                    </div>
                                                    <div>
                                                        <span className="text-xs font-bold text-emerald-600 uppercase tracking-wider">Explica√ß√£o</span>
                                                        <p className="mt-1 text-slate-800">{selectedProcess.classificacao.resumo || selectedProcess.classificacao.justificativa || selectedProcess.classificacao.explicacao}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="bg-slate-50 p-4 rounded-lg text-center text-slate-500 italic">
                                                Este processo ainda n√£o foi classificado pela IA.
                                            </div>
                                        )}

                                        {/* Movements History */}
                                        <div>
                                            <h3 className="text-lg font-semibold mb-3 text-slate-700 flex items-center gap-2">
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                                Hist√≥rico de Movimenta√ß√µes (Lido do XML)
                                            </h3>
                                            <div className="border border-slate-200 rounded-xl overflow-hidden">
                                                <table className="w-full text-sm text-left">
                                                    <thead className="bg-slate-50 text-slate-500 font-medium border-b border-slate-200">
                                                        <tr>
                                                            <th className="px-4 py-3 w-32">Data</th>
                                                            <th className="px-4 py-3">Descri√ß√£o</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="divide-y divide-slate-100">
                                                        {selectedProcess.movimentos && selectedProcess.movimentos.slice().reverse().map((mov, idx) => (
                                                            <tr key={idx} className="hover:bg-slate-50">
                                                                <td className="px-4 py-3 text-slate-500 whitespace-nowrap">
                                                                    {new Date(mov.dataHora).toLocaleString()}
                                                                </td>
                                                                <td className="px-4 py-3 text-slate-800">
                                                                    {mov.descricao}
                                                                    {mov.complemento && <div className="text-xs text-slate-500 mt-1">{mov.complemento}</div>}
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        {/* Raw Data Toggle (Optional) */}
                                        <details className="group">
                                            <summary className="flex items-center gap-2 cursor-pointer text-sm text-slate-400 hover:text-slate-600">
                                                <svg className="w-4 h-4 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7" /></svg>
                                                Ver JSON Bruto
                                            </summary>
                                            <pre className="mt-2 p-4 bg-slate-900 text-slate-50 rounded-lg text-xs overflow-x-auto font-mono">
                                                {JSON.stringify(selectedProcess, null, 2)}
                                            </pre>
                                        </details>
                                    </div>
                                </div>
                            </div>
                        )
                    }

                    {/* Chat Modal */}
                    {
                        chatProcess && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={closeChat}>
                                <div className="bg-white rounded-2xl shadow-2xl w-full max-w-3xl h-[80vh] flex flex-col" onClick={e => e.stopPropagation()}>
                                    {/* Header */}
                                    <div className="p-6 border-b border-slate-100 flex justify-between items-start bg-gradient-to-r from-purple-50 to-indigo-50">
                                        <div className="flex-1">
                                            <div className="flex items-center gap-2 mb-2">
                                                <svg className="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                                </svg>
                                                <h2 className="text-xl font-bold text-slate-800">Conversa sobre Classifica√ß√£o</h2>
                                            </div>
                                            <p className="text-sm text-slate-600">Processo: <span className="font-medium text-blue-600">{chatProcess.numero}</span></p>

                                            {/* Classification Summary */}
                                            {chatProcess.classificacao && (
                                                <div className="mt-2 text-xs bg-white/50 p-2 rounded border border-purple-100">
                                                    <span className="font-semibold text-purple-800">Classifica√ß√£o Atual:</span> {chatProcess.classificacao.tipo_intimacao || chatProcess.classificacao.codigo}
                                                </div>
                                            )}
                                        </div>
                                        <button onClick={closeChat} className="text-slate-400 hover:text-slate-600">
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                                        </button>
                                    </div>

                                    {/* Chat History */}
                                    <div className="flex-1 overflow-y-auto p-6 space-y-4 bg-slate-50">
                                        {chatHistory[chatProcess.numero]?.length === 0 && (
                                            <div className="text-center py-10 text-slate-400">
                                                <p>Inicie a conversa perguntando sobre a classifica√ß√£o deste processo.</p>
                                            </div>
                                        )}

                                        {chatHistory[chatProcess.numero]?.map((msg, idx) => (
                                            <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                                <div className={`max-w-[80%] rounded-2xl p-4 ${msg.role === 'user'
                                                        ? 'bg-blue-600 text-white rounded-br-none'
                                                        : 'bg-white border border-slate-200 text-slate-800 rounded-bl-none shadow-sm'
                                                    }`}>
                                                    <div className="text-sm whitespace-pre-wrap">{msg.content}</div>
                                                </div>
                                            </div>
                                        ))}

                                        {chatLoading && (
                                            <div className="flex justify-start">
                                                <div className="bg-white border border-slate-200 rounded-2xl rounded-bl-none p-4 shadow-sm flex items-center gap-2">
                                                    <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
                                                    <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                                                    <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    {/* Input Area */}
                                    <div className="p-4 bg-white border-t border-slate-100">
                                        <form onSubmit={handleSendChatMessage} className="flex gap-2">
                                            <input
                                                type="text"
                                                value={chatMessage}
                                                onChange={e => setChatMessage(e.target.value)}
                                                placeholder="Digite sua mensagem..."
                                                className="flex-1 px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all"
                                                disabled={chatLoading}
                                            />
                                            <button
                                                type="submit"
                                                disabled={!chatMessage.trim() || chatLoading}
                                                className="px-6 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                                            >
                                                <span>Enviar</span>
                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        )
                    }

                    {/* Batch Classification Modal */}
                    {
                        batchClassifyModal && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col">
                                    <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-gradient-to-r from-indigo-50 to-purple-50">
                                        <div>
                                            <h2 className="text-xl font-bold text-slate-800">Classifica√ß√£o em Lote</h2>
                                            <p className="text-sm text-slate-600">Processamento inteligente de m√∫ltiplos processos</p>
                                        </div>
                                        {!batchClassifyProgress.length && (
                                            <button onClick={() => setBatchClassifyModal(false)} className="text-slate-400 hover:text-slate-600">
                                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                                            </button>
                                        )}
                                    </div>

                                    <div className="p-6 overflow-y-auto space-y-6">
                                        {batchClassifyProgress.length === 0 ? (
                                            <div className="space-y-6">
                                                <div className="bg-blue-50 border border-blue-100 rounded-lg p-4 flex gap-3">
                                                    <svg className="w-6 h-6 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    <div className="text-sm text-blue-800">
                                                        <p className="font-semibold mb-1">Como funciona:</p>
                                                        <p>O sistema ir√° processar todos os processos pendentes ou reprocessar os existentes conforme sua configura√ß√£o. A IA analisar√° cada caso individualmente.</p>
                                                    </div>
                                                </div>

                                                <div className="space-y-4">
                                                    <div>
                                                        <label className="flex items-center gap-2 cursor-pointer">
                                                            <input
                                                                type="checkbox"
                                                                checked={batchSettings.force}
                                                                onChange={e => setBatchSettings({ ...batchSettings, force: e.target.checked })}
                                                                className="w-4 h-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500"
                                                            />
                                                            <span className="text-slate-700 font-medium">For√ßar reclassifica√ß√£o</span>
                                                        </label>
                                                        <p className="text-xs text-slate-500 ml-6 mt-1">Se marcado, reprocessar√° at√© os que j√° foram classificados.</p>
                                                    </div>

                                                    <div>
                                                        <label className="block text-sm font-medium text-slate-700 mb-1">Classe Processual (Opcional)</label>
                                                        <input
                                                            type="text"
                                                            value={batchSettings.classe}
                                                            onChange={e => setBatchSettings({ ...batchSettings, classe: e.target.value })}
                                                            placeholder="Ex: Procedimento Comum C√≠vel"
                                                            className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none"
                                                        />
                                                        <p className="text-xs text-slate-500 mt-1">Filtrar para processar apenas uma classe espec√≠fica.</p>
                                                    </div>

                                                    <div>
                                                        <label className="block text-sm font-medium text-slate-700 mb-1">Concorr√™ncia M√°xima: {batchSettings.maxConcurrent}</label>
                                                        <input
                                                            type="range"
                                                            min="1"
                                                            max="10"
                                                            value={batchSettings.maxConcurrent}
                                                            onChange={e => setBatchSettings({ ...batchSettings, maxConcurrent: parseInt(e.target.value) })}
                                                            className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                                        />
                                                        <div className="flex justify-between text-xs text-slate-400 mt-1">
                                                            <span>Mais lento (1)</span>
                                                            <span>Mais r√°pido (10)</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <button
                                                    onClick={startBatchClassify}
                                                    className="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 font-medium transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2"
                                                >
                                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    Iniciar Processamento
                                                </button>
                                            </div>
                                        ) : (
                                            <div className="space-y-4">
                                                {batchClassifyProgress.map((event, idx) => {
                                                    if (event.type === 'progress') {
                                                        return (
                                                            <div key={idx} className="bg-slate-50 rounded-lg p-4 border border-slate-100">
                                                                <div className="flex justify-between text-sm mb-2">
                                                                    <span className="font-medium text-slate-700">Progresso Geral</span>
                                                                    <span className="text-slate-500">{event.processados} / {event.total}</span>
                                                                </div>
                                                                <div className="w-full bg-slate-200 rounded-full h-2 overflow-hidden mb-4">
                                                                    <div
                                                                        className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                                                        style={{ width: `${(event.processados / event.total) * 100}%` }}
                                                                    ></div>
                                                                </div>
                                                                <div className="grid grid-cols-3 gap-2 text-center text-xs">
                                                                    <div className="bg-emerald-100 text-emerald-700 py-1 rounded">Sucesso: {event.sucesso}</div>
                                                                    <div className="bg-red-100 text-red-700 py-1 rounded">Erros: {event.erros}</div>
                                                                    <div className="bg-blue-100 text-blue-700 py-1 rounded">Restantes: {event.restantes}</div>
                                                                </div>
                                                            </div>
                                                        );
                                                    }

                                                    if (event.type === 'error') {
                                                        return (
                                                            <div key={idx} className="bg-red-50 border border-red-100 rounded-lg p-3 flex items-center gap-3">
                                                                <svg className="w-5 h-5 text-red-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                                                </svg>
                                                                <div className="flex-1">
                                                                    <div className="text-sm font-medium text-red-800">{event.numero}</div>
                                                                    <div className="text-xs text-red-600">{event.erro}</div>
                                                                </div>
                                                            </div>
                                                        );
                                                    }

                                                    if (event.type === 'complete') {
                                                        return (
                                                            <div key={idx} className="bg-indigo-50 border-2 border-indigo-200 rounded-lg p-6">
                                                                <div className="text-center mb-4">
                                                                    <div className="inline-flex items-center justify-center w-12 h-12 bg-indigo-600 rounded-full mb-3">
                                                                        <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" />
                                                                        </svg>
                                                                    </div>
                                                                    <h3 className="text-lg font-bold text-indigo-900">Classifica√ß√£o Conclu√≠da!</h3>
                                                                </div>
                                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                                    <div className="text-center p-3 bg-white rounded-lg">
                                                                        <div className="text-2xl font-bold text-slate-800">{event.total}</div>
                                                                        <div className="text-xs text-slate-500">Total</div>
                                                                    </div>
                                                                    <div className="text-center p-3 bg-white rounded-lg">
                                                                        <div className="text-2xl font-bold text-emerald-600">{event.sucesso}</div>
                                                                        <div className="text-xs text-slate-500">Sucessos</div>
                                                                    </div>
                                                                    <div className="text-center p-3 bg-white rounded-lg">
                                                                        <div className="text-2xl font-bold text-red-600">{event.erros}</div>
                                                                        <div className="text-xs text-slate-500">Erros</div>
                                                                    </div>
                                                                    <div className="text-center p-3 bg-white rounded-lg">
                                                                        <div className="text-2xl font-bold text-blue-600">{event.duracao_segundos}s</div>
                                                                        <div className="text-xs text-slate-500">Dura√ß√£o</div>
                                                                    </div>
                                                                </div>
                                                                <div className="mt-4 text-center text-sm text-slate-600">
                                                                    Velocidade: {event.processos_por_segundo} processos/segundo
                                                                </div>
                                                                <button
                                                                    onClick={() => {
                                                                        setBatchClassifyModal(false);
                                                                        setBatchClassifyProgress([]);
                                                                    }}
                                                                    className="w-full mt-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium transition-colors"
                                                                >
                                                                    Fechar
                                                                </button>
                                                            </div>
                                                        );
                                                    }

                                                    return null;
                                                })}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )
                    }
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>