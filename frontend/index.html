<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classificador de Intimações - TJMS</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const API_URL = "http://localhost:8000";

        function App() {
            console.log("App rendering v1.1");
            const [processes, setProcesses] = React.useState([]);
            const [prompts, setPrompts] = React.useState([]);
            const [view, setView] = React.useState('processes');
            const [selectedProcess, setSelectedProcess] = React.useState(null);
            const [editingPrompt, setEditingPrompt] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [bulkProgress, setBulkProgress] = React.useState({ current: 0, total: 0, errors: [] });
            const [isProcessingBulk, setIsProcessingBulk] = React.useState(false);
            const [inputProcessText, setInputProcessText] = React.useState("");
            const [classifyingProcess, setClassifyingProcess] = React.useState(null);
            const [collapsedGroups, setCollapsedGroups] = React.useState({});

            React.useEffect(() => {
                fetchProcesses();
                fetchPrompts();
            }, []);

            const fetchProcesses = async () => {
                try {
                    const res = await axios.get(`${API_URL}/processes/`);
                    setProcesses(res.data);
                } catch (err) {
                    console.error("Erro ao buscar processos:", err);
                }
            };

            const fetchPrompts = async () => {
                try {
                    const res = await axios.get(`${API_URL}/prompts/`);
                    setPrompts(res.data);
                } catch (err) {
                    console.error("Erro ao buscar prompts:", err);
                }
            };

            const handleAddProcess = async (e) => {
                e.preventDefault();
                if (!inputProcessText.trim()) return;

                const lines = inputProcessText.split(/[\n,]/).map(s => s.trim());
                // Sanitize: remove dots, dashes, and limit to 20 chars
                const validNumbers = lines
                    .map(s => s.replace(/[.-]/g, '').slice(0, 20))
                    .filter(s => s.length > 0);

                const uniqueNumbers = [...new Set(validNumbers)];

                if (uniqueNumbers.length === 0) return;

                setLoading(true);
                setIsProcessingBulk(true);
                setBulkProgress({ current: 0, total: uniqueNumbers.length, errors: [] });

                let completed = 0;
                const errors = [];

                for (const num of uniqueNumbers) {
                    try {
                        await axios.post(`${API_URL}/processes/${num}`);
                    } catch (err) {
                        console.error(`Erro ao adicionar ${num}:`, err);
                        errors.push({ number: num, error: err.message });
                    }
                    completed++;
                    setBulkProgress(prev => ({ ...prev, current: completed, errors }));
                }

                setIsProcessingBulk(false);
                setLoading(false);
                setInputProcessText("");
                fetchProcesses();

                if (errors.length > 0) {
                    alert(`Processamento concluído com ${errors.length} erros.\nVerifique o console para detalhes.`);
                }
            };

            const handleClassify = async (numero) => {
                console.log("Iniciando classificação para:", numero);
                setClassifyingProcess(numero);
                try {
                    await axios.post(`${API_URL}/classify/${numero}`);
                    fetchProcesses();
                    if (selectedProcess && selectedProcess.numero === numero) {
                        // Refresh selected process details if open
                        const updated = await axios.get(`${API_URL}/processes/`);
                        const p = updated.data.find(p => p.numero === numero);
                        if (p) setSelectedProcess(p);
                    }
                } catch (err) {
                    console.error("Erro na classificação:", err);
                    alert("Erro ao classificar: " + (err.response?.data?.detail || err.message));
                } finally {
                    setClassifyingProcess(null);
                }
            };

            const handleExport = async (format) => {
                window.open(`${API_URL}/export/${format}`, '_blank');
            };

            const handleSavePrompt = async (e) => {
                e.preventDefault();
                const p = editingPrompt;
                const classesArray = typeof p.classes === 'string' ? p.classes.split(',').map(c => c.trim()).filter(c => c) : p.classes;
                const payload = { ...p, classes: classesArray };

                try {
                    if (prompts.find(existing => existing.id === p.id)) {
                        await axios.put(`${API_URL}/prompts/${p.id}`, payload);
                    } else {
                        await axios.post(`${API_URL}/prompts/`, payload);
                    }
                    setEditingPrompt(null);
                    fetchPrompts();
                } catch (err) {
                    alert("Erro ao salvar prompt: " + (err.response?.data?.detail || err.message));
                }
            };

            const handleDeletePrompt = async (id) => {
                if (!confirm("Tem certeza?")) return;
                try {
                    await axios.delete(`${API_URL}/prompts/${id}`);
                    fetchPrompts();
                } catch (err) {
                    alert("Erro ao deletar prompt: " + (err.response?.data?.detail || err.message));
                }
            };

            // Grouping Logic
            const getGroupedProcesses = () => {
                const groups = {};

                processes.forEach(proc => {
                    let dateKey = "Não Classificado";
                    let sortDate = 0;

                    if (proc.data_classificacao) {
                        const date = new Date(proc.data_classificacao);
                        const today = new Date();
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);

                        if (date.toDateString() === today.toDateString()) {
                            dateKey = "Hoje";
                            sortDate = today.getTime();
                        } else if (date.toDateString() === yesterday.toDateString()) {
                            dateKey = "Ontem";
                            sortDate = yesterday.getTime();
                        } else {
                            dateKey = date.toLocaleDateString();
                            sortDate = date.getTime();
                        }
                    }

                    if (!groups[dateKey]) {
                        groups[dateKey] = { label: dateKey, sortDate, items: [] };
                    }
                    groups[dateKey].items.push(proc);
                });

                // Sort groups: Today first, then Yesterday, then dates descending, then Unclassified
                return Object.values(groups).sort((a, b) => {
                    if (a.label === "Hoje") return -1;
                    if (b.label === "Hoje") return 1;
                    if (a.label === "Ontem") return -1;
                    if (b.label === "Ontem") return 1;
                    if (a.label === "Não Classificado") return 1; // Put unclassified at bottom
                    if (b.label === "Não Classificado") return -1;
                    return b.sortDate - a.sortDate;
                });
            };

            const toggleGroup = (label) => {
                console.log("Toggling group:", label);
                setCollapsedGroups(prev => ({
                    ...prev,
                    [label]: !prev[label]
                }));
            };

            const groupedProcesses = getGroupedProcesses();

            return (
                <div className="container mx-auto p-6 max-w-7xl">
                    <header className="mb-10 flex justify-between items-center">
                        <div>
                            <h1 className="text-3xl font-bold text-slate-800 tracking-tight">
                                Classificador Judicial
                                <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full ml-2 align-middle">v1.1</span>
                            </h1>
                            <p className="text-slate-500 mt-1">Gestão e Inteligência Artificial para Processos</p>
                        </div>
                        <div className="flex gap-3">
                            <button onClick={() => setView('processes')} className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${view === 'processes' ? 'bg-blue-600 text-white' : 'bg-white border border-slate-200 hover:bg-slate-50'}`}>
                                Processos
                            </button>
                            <button onClick={() => setView('prompts')} className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${view === 'prompts' ? 'bg-blue-600 text-white' : 'bg-white border border-slate-200 hover:bg-slate-50'}`}>
                                Prompts
                            </button>
                            <div className="w-px h-8 bg-slate-200 mx-2"></div>
                            <button onClick={() => handleExport('json')} className="px-4 py-2 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 text-sm font-medium transition-colors">
                                Exportar JSON
                            </button>
                            <button onClick={() => handleExport('excel')} className="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 text-sm font-medium transition-colors shadow-sm">
                                Exportar Excel
                            </button>
                        </div>
                    </header>

                    {view === 'processes' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Sidebar / Add Process */}
                            <div className="lg:col-span-1 space-y-6">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                    <h2 className="text-lg font-semibold mb-4">Adicionar Processos</h2>
                                    <form onSubmit={handleAddProcess} className="space-y-3">
                                        <textarea
                                            value={inputProcessText}
                                            onChange={(e) => setInputProcessText(e.target.value)}
                                            placeholder="Cole aqui os números dos processos (um por linha ou separados por vírgula)..."
                                            rows={5}
                                            className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-sm font-mono"
                                        />

                                        {isProcessingBulk && (
                                            <div className="space-y-2">
                                                <div className="flex justify-between text-xs text-slate-500">
                                                    <span>Processando...</span>
                                                    <span>{bulkProgress.current} / {bulkProgress.total}</span>
                                                </div>
                                                <div className="w-full bg-slate-100 rounded-full h-2 overflow-hidden">
                                                    <div
                                                        className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                                        style={{ width: `${(bulkProgress.current / bulkProgress.total) * 100}%` }}
                                                    ></div>
                                                </div>
                                                {bulkProgress.errors.length > 0 && (
                                                    <p className="text-xs text-red-500">{bulkProgress.errors.length} erros encontrados</p>
                                                )}
                                            </div>
                                        )}

                                        <button
                                            type="submit"
                                            disabled={loading}
                                            className="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors disabled:opacity-50"
                                        >
                                            {loading ? (isProcessingBulk ? "Processando Lote..." : "Adicionando...") : "Adicionar"}
                                        </button>
                                    </form>
                                    <p className="text-xs text-slate-400 mt-2">
                                        Dica: Você pode colar até 300 números de uma vez. O sistema processará um por um. Pontos e traços são removidos automaticamente.
                                    </p>
                                </div>

                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                    <h2 className="text-lg font-semibold mb-4">Estatísticas</h2>
                                    <div className="space-y-4">
                                        <div className="flex justify-between items-center">
                                            <span className="text-slate-500">Total Processos</span>
                                            <span className="font-bold text-xl">{processes.length}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-slate-500">Classificados</span>
                                            <span className="font-bold text-xl text-emerald-600">{processes.filter(p => p.classificacao).length}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Main List */}
                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                                    <div className="p-6 border-b border-slate-100">
                                        <h2 className="text-lg font-semibold">Histórico de Processos</h2>
                                    </div>

                                    {processes.length === 0 ? (
                                        <div className="p-8 text-center text-slate-400">
                                            Nenhum processo cadastrado.
                                        </div>
                                    ) : (
                                        <div className="divide-y divide-slate-100">
                                            {groupedProcesses.map(group => (
                                                <div key={group.label}>
                                                    <div
                                                        className="bg-slate-50 px-6 py-2 text-xs font-bold text-slate-500 uppercase tracking-wider border-y border-slate-100 flex justify-between items-center cursor-pointer hover:bg-slate-100 transition-colors"
                                                        onClick={() => toggleGroup(group.label)}
                                                    >
                                                        <span>{group.label}</span>
                                                        <svg
                                                            className={`w-4 h-4 transition-transform ${collapsedGroups[group.label] ? '-rotate-90' : ''}`}
                                                            fill="none"
                                                            stroke="currentColor"
                                                            viewBox="0 0 24 24"
                                                        >
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                                                        </svg>
                                                    </div>
                                                    {!collapsedGroups[group.label] && group.items.map(proc => (
                                                        <div key={proc.numero} className="p-6 hover:bg-slate-50 transition-colors group relative">
                                                            {String(classifyingProcess) === String(proc.numero) && (
                                                                <div className="absolute inset-0 bg-white/80 z-10 flex items-center justify-center backdrop-blur-sm">
                                                                    <div className="flex flex-col items-center gap-2">
                                                                        <div className="w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                                                                        <span className="text-sm font-medium text-blue-600">Classificando...</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            <div className="flex justify-between items-start mb-3">
                                                                <div>
                                                                    <h3 className="font-medium text-blue-600 text-lg">{proc.numero}</h3>
                                                                    <p className="text-sm text-slate-500">{proc.classeProcessual} • {proc.competencia}</p>
                                                                </div>
                                                                <div className="flex gap-2">
                                                                    <button
                                                                        onClick={() => setSelectedProcess(proc)}
                                                                        className="px-3 py-1 text-xs font-medium bg-slate-100 text-slate-600 rounded-full hover:bg-slate-200 transition-colors"
                                                                    >
                                                                        Ver Detalhes
                                                                    </button>
                                                                    <button
                                                                        onClick={() => handleClassify(proc.numero)}
                                                                        disabled={String(classifyingProcess) === String(proc.numero)}
                                                                        className="px-3 py-1 text-xs font-medium bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 transition-colors disabled:opacity-50"
                                                                    >
                                                                        Classificar IA
                                                                    </button>
                                                                </div>
                                                            </div>

                                                            {/* Classification Summary */}
                                                            {proc.classificacao && (
                                                                <div className="mb-3 p-3 bg-emerald-50 border border-emerald-100 rounded-lg">
                                                                    <div className="flex items-center gap-2 mb-1">
                                                                        <span className="text-xs font-bold text-emerald-700 uppercase">Classificação IA</span>
                                                                        <span className="text-xs text-emerald-600">{new Date(proc.data_classificacao).toLocaleTimeString()}</span>
                                                                    </div>
                                                                    <div className="text-sm">
                                                                        <div><span className="font-semibold text-emerald-800">Tipo:</span> <span className="text-emerald-900">{proc.classificacao.tipo_intimacao || proc.classificacao.codigo || proc.classificacao.classificacao}</span></div>
                                                                    </div>
                                                                </div>
                                                            )}

                                                            {/* Movements Preview */}
                                                            <div className="mt-4 space-y-2">
                                                                <p className="text-xs font-semibold text-slate-400 uppercase tracking-wider">Última Movimentação</p>
                                                                {proc.movimentos && proc.movimentos.length > 0 ? (
                                                                    <div className="text-sm text-slate-700 bg-slate-50 p-3 rounded-lg border border-slate-100">
                                                                        <span className="font-medium block mb-1">{new Date(proc.movimentos[proc.movimentos.length - 1].dataHora).toLocaleDateString()}</span>
                                                                        {proc.movimentos[proc.movimentos.length - 1].descricao}
                                                                    </div>
                                                                ) : (
                                                                    <p className="text-sm text-slate-400 italic">Sem movimentações</p>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'prompts' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-1">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                    <h2 className="text-lg font-semibold mb-4">{editingPrompt ? 'Editar Prompt' : 'Novo Prompt'}</h2>
                                    <form onSubmit={handleSavePrompt} className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">ID (único)</label>
                                            <input
                                                type="text"
                                                value={editingPrompt?.id || ''}
                                                onChange={e => setEditingPrompt({ ...editingPrompt, id: e.target.value })}
                                                disabled={!!editingPrompt && prompts.some(p => p.id === editingPrompt.id)}
                                                className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none"
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Nome</label>
                                            <input
                                                type="text"
                                                value={editingPrompt?.name || ''}
                                                onChange={e => setEditingPrompt({ ...editingPrompt, name: e.target.value })}
                                                className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none"
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Classes (códigos separados por vírgula)</label>
                                            <input
                                                type="text"
                                                value={Array.isArray(editingPrompt?.classes) ? editingPrompt.classes.join(', ') : (editingPrompt?.classes || '')}
                                                onChange={e => setEditingPrompt({ ...editingPrompt, classes: e.target.value })}
                                                placeholder="Ex: 7, 1116, 1234"
                                                className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none"
                                            />
                                            <p className="text-xs text-slate-400 mt-1">Insira os códigos das classes que usarão este prompt</p>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Conteúdo do Prompt</label>
                                            <textarea
                                                value={editingPrompt?.content || ''}
                                                onChange={e => setEditingPrompt({ ...editingPrompt, content: e.target.value })}
                                                rows={10}
                                                className="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none font-mono text-sm"
                                                required
                                            />
                                        </div>
                                        <div className="flex gap-2">
                                            <button type="submit" className="flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                                                Salvar
                                            </button>
                                            {editingPrompt && (
                                                <button type="button" onClick={() => setEditingPrompt(null)} className="px-4 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200">
                                                    Cancelar
                                                </button>
                                            )}
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                                    <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                                        <h2 className="text-lg font-semibold">Prompts Configurados</h2>
                                        <button
                                            onClick={() => setEditingPrompt({ id: '', name: '', classes: [], content: '' })}
                                            className="text-sm text-blue-600 hover:underline font-medium"
                                        >
                                            + Novo Prompt
                                        </button>
                                    </div>
                                    <div className="divide-y divide-slate-100">
                                        {prompts.map(prompt => (
                                            <div key={prompt.id} className="p-6 hover:bg-slate-50 transition-colors">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div>
                                                        <h3 className="font-medium text-slate-900">{prompt.name} <span className="text-xs text-slate-400 font-normal ml-2">ID: {prompt.id}</span></h3>
                                                        <p className="text-sm text-slate-500 mt-1">
                                                            Classes: {prompt.classes && prompt.classes.length > 0 ? prompt.classes.join(', ') : <span className="italic">Nenhuma (será ignorado)</span>}
                                                        </p>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => setEditingPrompt(prompt)} className="text-blue-600 hover:text-blue-800 text-sm font-medium">Editar</button>
                                                        <button onClick={() => handleDeletePrompt(prompt.id)} className="text-red-600 hover:text-red-800 text-sm font-medium">Excluir</button>
                                                    </div>
                                                </div>
                                                <pre className="text-xs text-slate-600 bg-slate-50 p-3 rounded border border-slate-100 overflow-x-auto whitespace-pre-wrap max-h-32">
                                                    {prompt.content}
                                                </pre>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Process Details Modal */}
                    {selectedProcess && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setSelectedProcess(null)}>
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col" onClick={e => e.stopPropagation()}>
                                <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                    <div>
                                        <h2 className="text-xl font-bold text-slate-800">Processo {selectedProcess.numero}</h2>
                                        <p className="text-sm text-slate-500">{selectedProcess.classeProcessual}</p>
                                    </div>
                                    <button onClick={() => setSelectedProcess(null)} className="text-slate-400 hover:text-slate-600">
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                                    </button>
                                </div>

                                <div className="p-6 overflow-y-auto space-y-8">
                                    {/* Classification Details */}
                                    {selectedProcess.classificacao ? (
                                        <div>
                                            <h3 className="text-lg font-semibold mb-3 text-emerald-700 flex items-center gap-2">
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                                Resultado da Classificação
                                            </h3>
                                            <div className="bg-emerald-50 rounded-xl p-5 border border-emerald-100 space-y-4">
                                                <div>
                                                    <span className="text-xs font-bold text-emerald-600 uppercase tracking-wider">Tipo de Intimação</span>
                                                    <p className="mt-1 text-slate-800 font-medium">{selectedProcess.classificacao.tipo_intimacao || selectedProcess.classificacao.codigo || selectedProcess.classificacao.classificacao}</p>
                                                </div>
                                                <div>
                                                    <span className="text-xs font-bold text-emerald-600 uppercase tracking-wider">Explicação</span>
                                                    <p className="mt-1 text-slate-800">{selectedProcess.classificacao.resumo || selectedProcess.classificacao.justificativa || selectedProcess.classificacao.explicacao}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="bg-slate-50 p-4 rounded-lg text-center text-slate-500 italic">
                                            Este processo ainda não foi classificado pela IA.
                                        </div>
                                    )}

                                    {/* Movements History */}
                                    <div>
                                        <h3 className="text-lg font-semibold mb-3 text-slate-700 flex items-center gap-2">
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                            Histórico de Movimentações (Lido do XML)
                                        </h3>
                                        <div className="border border-slate-200 rounded-xl overflow-hidden">
                                            <table className="w-full text-sm text-left">
                                                <thead className="bg-slate-50 text-slate-500 font-medium border-b border-slate-200">
                                                    <tr>
                                                        <th className="px-4 py-3 w-32">Data</th>
                                                        <th className="px-4 py-3">Descrição</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-slate-100">
                                                    {selectedProcess.movimentos && selectedProcess.movimentos.slice().reverse().map((mov, idx) => (
                                                        <tr key={idx} className="hover:bg-slate-50">
                                                            <td className="px-4 py-3 text-slate-500 whitespace-nowrap">
                                                                {new Date(mov.dataHora).toLocaleString()}
                                                            </td>
                                                            <td className="px-4 py-3 text-slate-800">
                                                                {mov.descricao}
                                                                {mov.complemento && <div className="text-xs text-slate-500 mt-1">{mov.complemento}</div>}
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    {/* Raw Data Toggle (Optional) */}
                                    <details className="group">
                                        <summary className="flex items-center gap-2 cursor-pointer text-sm text-slate-400 hover:text-slate-600">
                                            <svg className="w-4 h-4 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7" /></svg>
                                            Ver JSON Bruto
                                        </summary>
                                        <pre className="mt-2 p-4 bg-slate-900 text-slate-50 rounded-lg text-xs overflow-x-auto font-mono">
                                            {JSON.stringify(selectedProcess, null, 2)}
                                        </pre>
                                    </details>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>